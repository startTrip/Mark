package com.mihua.market.pay;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;
import java.util.Random;

/**
 * Project: TRShop_v1.36
 * Author: wm
 * Data:   2016/10/12
 */
public class AlipayHelper {

    // ???PID  ?????? 2088 ???
    public static final String PARTNER = "2088111278561763";
    // ?????????????????????????????????????
    public static final String SELLER = "gaoyandingzhi@126.com";
    // ????????????????????????????????????????????????¨´?????????
    public static final String RSA_PRIVATE = "MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBANEClM9ja39OuhbiFcPYG8nUt19TIGvnBjC2CGMV3BKY2pTolVuicMfM0yyxvwtewe7Wkk+06Zl8fjgIWZS8SsfOeznQZbJq236CbcFYIhDsorDllDwQ0Uk409WSjaOCDJamOjGeQjYqy3D7v+z+Z48ZvCOPleX2h415mHQeHWVdAgMBAAECgYB6FrHqOr7uTIRzHXltPu1shi7fJeWIYhjBl3NqvbghvNvho8KrFkYez8yDDQj1kVJjOz+YA6t4lrn77RS2xw4+fRJgBy/LD9ILectaThysuFt84yKooSuFAv1AQKMeVXkpnFuzzBFtxyuRPtPUYXftSvEm/9BapFHGEVCuT7RvAQJBAP9yq18VFhPQAfngld9n0NwmCO33kdbFYqVIWBNKZdvVZIqwIvnmTqsgQacrvWutsWauukKT7VzySkht/uE63j0CQQDRdjgqx4H7SfMjkaZK5nJ6ptuFgR19HkakOJZSIM78Ot3PzfHcnfYuCRjs8lIEWmhYqj2FE+BcZ9cejphGuTWhAkB0XimBXBq9ldGAonXD2whDcbQ5q8EtJKgmgUlWKFs0hQaTQ1/7lZYa0Mv3uq5EwlCBZXGGaNsFr351dl5Y/jdFAkA6D2DmSsL22rqwo1DK9jHJWbMDwJRh+CBwqNbSERIOzGprjZR7KLXycMcd9tVRK5Y87YN7/dR1CLuSVshS4kfBAkAW6ls9/RlBA6gOpDuq+Qn4CZUng3h7OJsDgzCY95RtuMISJNuVFcGC/XVKB+urkyfhR/H7I8HIPXQtNJenH9f2";

    // ????????
    public static final String RSA_PUBLIC = "";

    /**
     * create the order info. ???????????
     *
     */
    public static String getOrderInfo(String subject, String body, String price) {

        // ???????????ID
        String orderInfo = "partner=" + "\"" + PARTNER + "\"";

        // ??????????????
        orderInfo += "&seller_id=" + "\"" + SELLER + "\"";

        // ??????¦·???????
        // TODO ??????????????????????????????
        orderInfo += "&out_trade_no=" + "\"" + getOutTradeNo() + "\"";

        // ??????
        orderInfo += "&subject=" + "\"" + subject + "\"";

        // ???????
        orderInfo += "&body=" + "\"" + body + "\"";

        // ??????
        orderInfo += "&total_fee=" + "\"" + price + "\"";

        // ?????????????¡¤??
        // ?????????????????????????????????????????????????????????????
        orderInfo += "&notify_url=" + "\"" + "http://notify.msp.hk/notify.htm" + "\"";

        // ?????????? ????
        orderInfo += "&service=\"mobile.securitypay.pay\"";

        // ???????? ????
        orderInfo += "&payment_type=\"1\"";

        // ??????? ????
        orderInfo += "&_input_charset=\"utf-8\"";

        // ????¦Ä????????????
        // ???30??????????????????????????????
        // ????¦¶??1m??15d??
        // m-?????h-§³???d-??1c-???????????????????????0???????
        // ?¨°????????????§³?????1.5h????????90m??
        orderInfo += "&it_b_pay=\"30m\"";

        // extern_token?????????????????alipay_open_id,???????????????????????????????
        // orderInfo += "&extern_token=" + "\"" + extern_token + "\"";

        // ????????????????????????????????????¡¤???????
        orderInfo += "&return_url=\"m.alipay.com\"";

        return orderInfo;
    }

    /**
     * get the out_trade_no for an order. ????????????????????????????¦·?????????????œZ??
     *
     */
    public static String getOutTradeNo() {
        SimpleDateFormat format = new SimpleDateFormat("MMddHHmmss", Locale.getDefault());
        Date date = new Date();
        String key = format.format(date);

        Random r = new Random();
        key = key + r.nextInt();
        key = key.substring(0, 15);
        return key;
    }

    /**
     * sign the order info. ???????????????
     *
     * @param content
     *            ????????
     */
    public static String sign(String content) {
        return SignUtils.sign(content, RSA_PRIVATE);
    }

    /**
     * get the sign type we use. ???????
     *
     */
    public static String getSignType() {
        return "sign_type=\"RSA\"";
    }

}
